# https://api.resourcewatch.org/v1/dataset/f4fbeb5a-9c0f-45bc-b6c3-b605eee04213/layer/11af6ad2-9e15-4fb2-98f2-1fa32a73f395

@host = https://api.resourcewatch.org
@token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYzYzcwOTBiZTU5MTU5NmYyN2MxOThjYSIsInJvbGUiOiJBRE1JTiIsInByb3ZpZGVyIjoibG9jYWwiLCJlbWFpbCI6IkNhcmxvcy5EZWxSZWFsLjVAd3JpY29uc3VsdGFudC5vcmciLCJleHRyYVVzZXJEYXRhIjp7ImFwcHMiOlsicnciLCJhcXVlZHVjdCIsImFxdWVkdWN0LXdhdGVyLXJpc2siXX0sImNyZWF0ZWRBdCI6MTY4Njc3NTUyNTAyNSwicGhvdG8iOiJodHRwczovL3MzLmFtYXpvbmF3cy5jb20vd3JpLWFwaS1iYWNrdXBzL3Jlc291cmNld2F0Y2gvc3RhZ2luZy9wcm9maWxlcy9hdmF0YXJzLzAwMC8wMDAvMjU4L29yaWdpbmFsL2RhdGE_MTY3NDA2ODA0NyIsIm5hbWUiOiJDYXJsb3MgRGVsIFJlYWwiLCJpYXQiOjE2ODY3NzU1MjV9.3J7HR6Et_5wmJbbfjnh_7ZvrClzIsRAdwaqMJEMmOuM

@oldDSId = ea9dacf1-c11e-4e6a-ad63-8804111a75ba
@oldLayer = 533e0d69-8bb5-45c0-a036-642bf7b977df

@newDSId = f4fbeb5a-9c0f-45bc-b6c3-b605eee04213
@newLayer = 11af6ad2-9e15-4fb2-98f2-1fa32a73f395

### old
GET https://api.resourcewatch.org/v1/dataset/{{oldDSId}}/layer/{{oldLayer}}

### new
GET https://api.resourcewatch.org/v1/dataset/{{newDSId}}/layer/{{newLayer}}


### create layer in new dataset

PATCH  {{host}}/v1/dataset/{{newDSId}}/layer/{{newLayer}}
Content-Type: application/json
Authorization: {{token}}

{
   "name": "Country mask",
   "slug": "Country-mask_1",
   "application": [
      "aqueduct"
   ],
   "provider": "cartodb",
   "default": true,
   "protected": false,
   "published": true,
   "env": "production",
   "layerConfig": {
      "account": "wri-01",
      "params_config": [
         {
               "key": "iso",
               "required": true
         }
      ],
      "sql_config": [],
      "body": {
         "maxzoom": 18,
         "minzoom": 3,
         "layers": [
               {
                  "type": "cartodb",
                  "options": {
                     "sql": "SELECT * FROM country_mask",
                     "cartocss": "#country_mask{polygon-fill:#000;polygon-opacity:.1;line-color:#000;line-opacity:.1;line-width:0}#country_mask[code='{{iso}}']{polygon-fill:#FFF;polygon-opacity:0;line-opacity:1}",
                     "cartocss_version": "2.3.0"
                  }
               }
         ]
      }
   },
   "legendConfig": {}
}

### publish
PATCH {{host}}/v1/dataset/{{newDSId}}
Content-Type: application/json
Authorization: {{token}}

{
    "published": true
}