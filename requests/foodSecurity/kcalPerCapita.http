https://api.resourcewatch.org/v1/dataset/e26e348b-ce47-48c2-945c-ba7c5caf1cc0/layer/24ece36f-b67a-4b71-a7a0-f6accaf630ab


@host = https://api.resourcewatch.org
@token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYzYzcwOTBiZTU5MTU5NmYyN2MxOThjYSIsInJvbGUiOiJBRE1JTiIsInByb3ZpZGVyIjoibG9jYWwiLCJlbWFpbCI6IkNhcmxvcy5EZWxSZWFsLjVAd3JpY29uc3VsdGFudC5vcmciLCJleHRyYVVzZXJEYXRhIjp7ImFwcHMiOlsicnciLCJhcXVlZHVjdCIsImFxdWVkdWN0LXdhdGVyLXJpc2siXX0sImNyZWF0ZWRBdCI6MTY4Njc3NTUyNTAyNSwicGhvdG8iOiJodHRwczovL3MzLmFtYXpvbmF3cy5jb20vd3JpLWFwaS1iYWNrdXBzL3Jlc291cmNld2F0Y2gvc3RhZ2luZy9wcm9maWxlcy9hdmF0YXJzLzAwMC8wMDAvMjU4L29yaWdpbmFsL2RhdGE_MTY3NDA2ODA0NyIsIm5hbWUiOiJDYXJsb3MgRGVsIFJlYWwiLCJpYXQiOjE2ODY3NzU1MjV9.3J7HR6Et_5wmJbbfjnh_7ZvrClzIsRAdwaqMJEMmOuM

@oldDSId = c6d487f0-42ad-4513-ac99-108d4c51dab1
@oldLayer = bd4a831a-e43b-429b-9eb3-593176718812

@newDSId = e26e348b-ce47-48c2-945c-ba7c5caf1cc0
@newLayer = 24ece36f-b67a-4b71-a7a0-f6accaf630ab

### old
GET https://api.resourcewatch.org/v1/dataset/{{oldDSId}}?includes=metadata
### old
GET https://api.resourcewatch.org/v1/dataset/{{oldDSId}}/layer/{{oldLayer}}

### new
GET https://api.resourcewatch.org/v1/dataset/{{newDSId}}?includes=metadata
### new
GET https://api.resourcewatch.org/v1/dataset/{{newDSId}}/layer/{{newLayer}}

### update new ds
PATCH  {{host}}/v1/dataset/{{newDSId}}/layer/{{newLayer}}
Content-Type: application/json
Authorization: {{token}}

{
  "name": "Kcal per capita",
  "slug": "Kcal-per-capita_1",
  "description": "",
  "application": [
      "aqueduct"
  ],
  "provider": "cartodb",
  "default": false,
  "protected": false,
  "published": true,
  "thumbnailUrl": "https://s3.amazonaws.com/wri-api-backups/resourcewatch/prod/thumbnails/24ece36f-b67a-4b71-a7a0-f6accaf630ab-1724698308354.png",
  "env": "production",
  "layerConfig": {
      "type": "leaflet",
      "params_config": [],
      "sql_config": [
          {
              "key": "where",
              "key_params": [
                  {
                      "key": "year",
                      "required": true
                  }
              ]
          }
      ],
      "body": {
          "url": "https://wri-rw.carto.com/api/v2/sql?q=with s as (SELECT iso, region, value, commodity FROM combined01_prepared_2020v1 {{where}} and impactparameter='Kcal per capita' and iso is not null ), r as (SELECT iso, region, sum(value) as value FROM s group by iso, region), d as (SELECT centroid as geometry, iso, value, region FROM impact_regions_159 t inner join r on new_region=iso) select json_build_object('type','FeatureCollection','features',json_agg(json_build_object('geometry',cast(geometry as json),'properties', json_build_object('value',value,'country',region,'iso',iso, 'unit', 'Kilocalories per person'),'type','Feature'))) as data from d",
          "use_cors": false
      }
  },
  "legendConfig": {
      "items": [
          {
              "color": "rgba(53, 89, 161, 0.85)",
              "name": "Kcal per person"
          }
      ],
      "units": "kcal/person/day",
      "description": "Kilocalories per person represents the average availability of calories per person, by country. Note that it is not crop specific.",
      "type": "cluster"
  }
}

### publish
PATCH {{host}}/v1/dataset/{{newDSId}}
Content-Type: application/json
Authorization: {{token}}

{
    "published": true
}